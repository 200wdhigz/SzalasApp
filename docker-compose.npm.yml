# Docker Compose dla SzalasApp z Nginx Proxy Manager
# Ten plik jest używany gdy masz już zainstalowany Nginx Proxy Manager w osobnym docker-compose
#
# Uruchomienie:
# docker compose -f docker-compose.npm.yml up -d --build
#
# Wymagania:
# 1. Nginx Proxy Manager już działa w osobnym docker-compose
# 2. Utworzona została zewnętrzna sieć Docker: docker network create proxy-network
# 3. NPM jest podłączony do sieci proxy-network
# 4. Skonfigurowany .env z wszystkimi wymaganymi zmiennymi

version: '3.8'

services:
  app:
    image: filiprar/szalasapp:latest
    container_name: szalasapp

    expose:
      - "8080"

    # Load most configuration from .env (avoids issues with '$' being treated as variable interpolation)
    env_file:
      - .env

    environment:
      - PORT=8080
      - HOST=0.0.0.0
      - DEBUG=${DEBUG:-False}
      - GOOGLE_APPLICATION_CREDENTIALS=${GOOGLE_APPLICATION_CREDENTIALS:-/app/credentials/service-account.json}

    volumes:
      - ./credentials:/app/credentials:ro

    restart: unless-stopped

    networks:
      - proxy-network

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  proxy-network:
    external: true

# INSTRUKCJA KONFIGURACJI NGINX PROXY MANAGER:
#
# 1. Utwórz sieć (jeśli jeszcze nie istnieje):
#    docker network create proxy-network
#
# 2. Dodaj NPM do tej sieci (edytuj docker-compose.yml NPM):
#    networks:
#      - proxy-network
#
#    networks:
#      proxy-network:
#        external: true
#
# 3. Uruchom SzalasApp:
#    docker compose -f docker-compose.npm.yml up -d --build
#
# 4. Skonfiguruj Proxy Host w NPM:
#    - Domain: szalasapp.kawak.uk
#    - Forward Hostname: szalasapp (nazwa kontenera)
#    - Forward Port: 8080
#    - SSL: Request new certificate (Let's Encrypt)
#    - Force SSL: włącz
#
# Więcej informacji w dokumentacji:
# wiki/docs/26_DEPLOYMENT_PRODUCTION.md - sekcja "Wariant A: Nginx Proxy Manager"
